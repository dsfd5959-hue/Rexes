<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rexes Debug</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –°—Ç–∏–ª–∏ —Ç–µ –∂–µ, —Å–æ–∫—Ä–∞—â–µ–Ω—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞, –≥–ª–∞–≤–Ω–æ–µ —Å–∫—Ä–∏–ø—Ç –≤–Ω–∏–∑—É */
        :root { --bg: #0F0F10; --card: #1C1C1E; --input-bg: #2C2C2E; --orange: #FF5500; --text: #FFFFFF; --gray: #8E8E93; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 0 0 40px 0; }
        .screen { display: none; padding-top: 10px; }
        .screen.active { display: block; }
        .btn-main { width: 100%; padding: 16px; border-radius: 14px; border: none; font-size: 16px; font-weight: 700; cursor: pointer; background: var(--orange); color: white; margin-top: 20px; }
        .form-input { width: 100%; background: var(--card); border: 1px solid #333; color: white; padding: 16px; border-radius: 12px; font-size: 16px; outline: none; margin-bottom: 10px; }
        .header { padding: 16px; font-weight: bold; font-size: 18px; }
        
        /* –ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å—Ç–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∞ */
        .container { padding: 16px; }
        .debug-info { color: yellow; font-size: 12px; margin-bottom: 10px; display: none; }
    </style>
</head>
<body>

    <div id="screen-home" class="screen active">
        <div class="header">Rexes: –¢–µ—Å—Ç —Ñ–æ—Ä–º—ã</div>
        
        <div class="container">
            <p style="color: gray; font-size: 13px;">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏:</p>

            <label>–°—É–º–º–∞ (USDT):</label>
            <input type="number" id="amount" class="form-input" value="100">

            <label>–§–ò–û:</label>
            <input type="text" id="fio" class="form-input" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω">

            <label>–ö–æ–Ω—Ç–∞–∫—Ç:</label>
            <input type="text" id="contact" class="form-input" placeholder="@username">

            <label>–ú–µ—Ç–æ–¥:</label>
            <input type="text" id="method" class="form-input" placeholder="–ù–∞–ª–∏—á–Ω—ã–µ">

            <button class="btn-main" onclick="debugSubmit()">üöÄ –û–¢–ü–†–ê–í–ò–¢–¨ (–¢–ï–°–¢)</button>
            
            <br><br>
            <button onclick="window.location.reload()" style="background: #333; color: white; border: none; padding: 10px; width: 100%; border-radius: 10px;">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        try {
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                document.getElementById('contact').value = '@' + tg.initDataUnsafe.user.username;
            }
        } catch (e) {
            console.log(e);
        }

        function debugSubmit() {
            // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∫–Ω–æ–ø–∫–∞
            tg.showPopup({
                title: '–®–∞–≥ 1',
                message: '–ö–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞. –°–µ–π—á–∞—Å –Ω–∞—á–Ω–µ–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö.',
                buttons: [{type: 'ok'}]
            }, function() {
                
                // 2. –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ callback-–∞
                try {
                    const amount = document.getElementById('amount').value;
                    const fio = document.getElementById('fio').value;
                    const contact = document.getElementById('contact').value;
                    const method = document.getElementById('method').value;

                    if (!fio || !contact) {
                        tg.showAlert("–û—à–∏–±–∫–∞: –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û –∏ –ö–æ–Ω—Ç–∞–∫—Ç!");
                        return;
                    }

                    // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç
                    const data = {
                        type: 'BUY',
                        coin: 'USDT (Test)',
                        amount_in: amount,
                        currency_in: 'USDT',
                        amount_out: (amount * 98).toFixed(2),
                        currency_out: 'RUB',
                        city: '–¢–µ—Å—Ç–æ–≤—ã–π –ì–æ—Ä–æ–¥',
                        fio: fio,
                        contact: contact,
                        method: method
                    };

                    const dataString = JSON.stringify(data);

                    // 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
                    tg.showPopup({
                        title: '–®–∞–≥ 2: –î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã',
                        message: '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —ç—Ç–æ –±–æ—Ç—É:\n' + dataString,
                        buttons: [{type: 'ok', text: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å'}]
                    }, function(btnId) {
                        
                        // 4. –û–¢–ü–†–ê–í–ö–ê
                        try {
                            tg.sendData(dataString);
                            // –ù–ï –ó–ê–ö–†–´–í–ê–ï–ú –ü–†–ò–õ–û–ñ–ï–ù–ò–ï, –ß–¢–û–ë–´ –£–í–ò–î–ï–¢–¨ –†–ï–ó–£–õ–¨–¢–ê–¢
                            // tg.close(); 
                        } catch (err) {
                            tg.showAlert("–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê sendData: " + err);
                        }
                    });

                } catch (e) {
                    tg.showAlert("–û–®–ò–ë–ö–ê JS: " + e.message);
                }
            });
        }
    </script>
</body>
</html>